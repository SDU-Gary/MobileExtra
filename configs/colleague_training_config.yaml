# 数据配置
data:
  data_root: "./data"  # 数据根目录 (包含processed_bistro)
  dataset_type: "colleague"  # 使用ColleagueDatasetAdapter
  data_format: "processed_bistro"  # 指定数据格式
  splits:
    train: "train"
    val: "val" 
    test: "test"
  
  processed_bistro_path: "./data/processed_bistro"  # OpenEXR数据路径
  required_subdirs: ["warp_hole", "ref", "bistro"]  # 必需的子目录

# Patch训练配置
patch:
  enable_patch_mode: true
  patch_height: 270  # 4x4网格切分后的patch高度 (1080/4)
  patch_width: 480   # 4x4网格切分后的patch宽度 (1920/4)  
  patch_size: 270    # 保持兼容性，主要用于内存估算
  patch_mode_probability: 1.0  # 始终使用patch模式以确保简单网格的一致性
  
  # 简单网格策略配置 (推荐用于训练稳定性)
  use_simple_grid_patches: true      # 启用简单4x4网格策略
  use_optimized_patches: false       # 禁用复杂的hole detection
  
  # 简单网格参数
  simple_grid_rows: 4                # 网格行数 (短边)
  simple_grid_cols: 4                # 网格列数 (长边)
  simple_expected_height: 1080       # 预期输入高度
  simple_expected_width: 1920        # 预期输入宽度
  
  # 传统patch参数 (简单网格模式下会被覆盖)
  min_patches_per_image: 16          # 固定16个patch
  max_patches_per_image: 16          # 固定16个patch
  
  # 缓存配置（简单网格模式下暂时禁用）
  enable_patch_cache: false
  cache_size: 1000
  
  # 数据增强（禁用以避免颜色映射问题）
  patch_augmentation: false
  augmentation_probability: 0.0

# 网络配置
network:
  type: "PatchNetwork"
  input_channels: 7  # 保持7通道输入不变
  output_channels: 3
  base_channels: 24  # 增加网络容量，base_channels 24→64
  learning_mode: "residual"  # 残差学习模式
  
  # 增强架构详情
  architecture_details:
    encoder_layers: 5  # 5层编码器
    decoder_layers: 5  # 5层解码器
    channel_progression: "64→96→128→192→256"  # 渐进式通道增长
    boundary_detection: "edge_based"  # 边缘检测（与损失函数对齐）
  
# 训练配置
training:
  batch_size: 4
  num_workers: 2
  learning_rate: 0.0005  # 经过优化的学习率 (5e-4)
  weight_decay: 0.0001  # 1e-4
  max_epochs: 200
  
  # 优化器配置
  optimizer: "AdamW"
  scheduler: "CosineAnnealingLR"
  scheduler_params:
    T_max: 100
    eta_min: 0.000001  # 1e-6

# 损失函数配置
loss:
  type: "ResidualInpaintingLoss"
  weights:
    mse: 1.0
    l1: 0.5
    perceptual: 0.8  # 提升感知损失权重
    edge: 0.5        # 提升边缘损失权重
    boundary: 0.3
  
  # 残差学习特定配置
  residual_scale_factor: 2.0
  spatial_attention: true

# 验证和监控
validation:
  frequency: 5  # 每5个epoch验证一次
  metrics: ["mse", "psnr", "ssim"]
  
monitoring:
  tensorboard_log_dir: "./logs/colleague_training"
  model_save_dir: "./models/colleague"
  save_frequency: 10
  
# 内存管理
memory:
  enable_ultra_safe_mode: true
  max_gpu_memory_gb: 4
  garbage_collection_frequency: 10
