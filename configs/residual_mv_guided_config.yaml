# æ®‹å·®MVå¼•å¯¼ç½‘ç»œé…ç½® - ä»»åŠ¡æœ¬è´¨é©±åŠ¨çš„æ¶æ„è®¾è®¡
# æ ¸å¿ƒç†å¿µ: å­¦ä¹ æ®‹å·®ä¿®æ­£è€Œéå…¨å›¾é‡å»ºï¼ŒçœŸæ­£çš„"è¡¥æ´"ä»»åŠ¡
# åŸºäº: ExtraNeté—¨æ§å·ç§¯ + ç©ºé—´æ³¨æ„åŠ› + æ®‹å·®å­¦ä¹ 

experiment:
  name: "residual_mv_guided_inpainting"
  version: "v1.0"
  description: "æ®‹å·®MVå¼•å¯¼çš„é€‰æ‹©æ€§è¡¥æ´ç½‘ç»œï¼Œä»ä»»åŠ¡æœ¬è´¨é‡æ–°è®¾è®¡æ¶æ„"

# æ•°æ®é›†é…ç½® - ä¿æŒå…¨åˆ†è¾¨ç‡HDRæ•°æ®
datasets:
  train_data_root: "./output_motion_fix"
  preprocessing:
    # ç»§ç»­ä½¿ç”¨å®Œæ•´åˆ†è¾¨ç‡
    target_resolution: [540, 960]   # ä¿®å¤ï¼šé™ä½åˆ†è¾¨ç‡æå‡è®­ç»ƒé€Ÿåº¦ï¼ˆ4å€é€Ÿåº¦æå‡ï¼‰
    normalize_method: "unified"     # ä¿®å¤ï¼šç»Ÿä¸€å½’ä¸€åŒ–æ–¹æ³•ï¼Œé…åˆinput_normalizerä½¿ç”¨
    augmentation: false              # ç¦ç”¨æ•°æ®å¢å¼ºé¿å…å¤æ‚æ€§
  train_split: 0.8
  val_split: 0.2

# æ¨¡å‹é…ç½® - æ ¸å¿ƒåˆ›æ–°ï¼šæ®‹å·®MVå¼•å¯¼æ¶æ„
model:
  architecture: "residual_mv_guided"  # æ–°æ¶æ„ç±»å‹
  input_channels: 7
  output_channels: 3
  
  # æ®‹å·®MVå¼•å¯¼ç½‘ç»œä¸“é—¨é…ç½®ï¼ˆå†…å­˜ä¼˜åŒ–ï¼‰
  residual_mv_config:
    # ç½‘ç»œç»“æ„å‚æ•°ï¼ˆå‡å°‘é€šé“æ•°ä»¥èŠ‚çœå†…å­˜ï¼‰
    encoder_channels: [24, 48, 96, 192, 256]   # å‡å°‘ä¸»ä½“ç‰¹å¾æå–å™¨é€šé“ï¼ˆçº¦40%å†…å­˜èŠ‚çœï¼‰
    mv_feature_channels: 24                     # å‡å°‘MVæŒ‡å¯¼ç‰¹å¾é€šé“æ•°
    
    # é—¨æ§å·ç§¯é…ç½®ï¼ˆå‚è€ƒExtraNetï¼‰
    use_gated_conv: true                        # å¯ç”¨é—¨æ§å·ç§¯å¤„ç†ä¸è§„åˆ™ç©ºæ´
    
    # ç©ºé—´æ³¨æ„åŠ›é…ç½®
    attention_config:
      use_gated_attention: true                 # é—¨æ§æ³¨æ„åŠ›ç”Ÿæˆ
      mv_sensitivity: 0.05                      # MVç´§æ€¥ç¨‹åº¦çµæ•åº¦
      
    # æ®‹å·®å­¦ä¹ é…ç½®
    residual_learning:
      enable_residual_composition: true         # å¯ç”¨æ®‹å·®ç»„åˆ: output = warped + correction
      clamp_mv_range: [-100, 100]             # æ®‹å·®MVèŒƒå›´é™åˆ¶ï¼ˆåƒç´ ï¼‰
      mv_normalization_factor: 100.0          # MVå½’ä¸€åŒ–å› å­
    
    # é€‰æ‹©æ€§ä¿®å¤é…ç½®
    selective_repair:
      spatial_attention_guidance: true         # ç©ºé—´æ³¨æ„åŠ›å¼•å¯¼ä¿®å¤
      preservation_non_repair_regions: true   # ä¿æŒéä¿®å¤åŒºåŸŸä¸å˜
      
  # ç½‘ç»œå‚æ•°
  dropout_rate: 0.1
  activation: "relu"
  
  # ç»Ÿä¸€è¾“å…¥å½’ä¸€åŒ–ï¼ˆè§£å†³å½’ä¸€åŒ–ä¸ä¸€è‡´é—®é¢˜ï¼‰
  enable_input_normalization: true
  
  # ä¿®æ­£çš„è¾“å…¥å½’ä¸€åŒ–é…ç½®ï¼ˆæ–°ç­–ç•¥ï¼‰
  input_normalizer:
    rgb_method: "hdr_to_ldr"         # æ–°ç­–ç•¥ï¼šHDRâ†’LDRâ†’å½’ä¸€åŒ–
    tone_mapping: "reinhard"         # tone mappingæ–¹æ³• (reinhard|aces|exposure|filmic|clamp)
    normalize_masks: false           # æ©ç ä¸å½’ä¸€åŒ–ï¼Œä¿æŒ[0,1]åŸå§‹å€¼
    normalize_mv: false              # æ®‹å·®MVä¸å½’ä¸€åŒ–ï¼Œä¿æŒåƒç´ åç§»å€¼
    gamma: 2.2                       # gammaæ ¡æ­£å€¼

# æŸå¤±å‡½æ•°é…ç½® - å¹³è¡¡çš„æ®‹å·®è¡¥æ´æŸå¤±ï¼ˆé™ä½æƒé‡é¿å…éœ‡è¡ï¼‰
loss:
  # æ®‹å·®å­¦ä¹ æŸå¤±ï¼ˆæ ¸å¿ƒï¼‰
  residual_mse_weight: 1.0        # ä¿®å¤ï¼šå¢åŠ ä¸»æŸå¤±æƒé‡ä¸»å¯¼è®­ç»ƒ
  residual_l1_weight: 0.4         # é™ä½L1æŸå¤±æƒé‡
  
  # ç©ºé—´åŠ æƒæŸå¤±ï¼ˆé‡ç‚¹å…³æ³¨ä¿®å¤åŒºåŸŸï¼‰
  spatial_weighted_weight: 0.6    # é™ä½ç©ºé—´åŠ æƒæŸå¤±æƒé‡
  
  # ä¿æŒæ€§æŸå¤±ï¼ˆä¿æŠ¤éä¿®å¤åŒºåŸŸï¼‰
  preservation_weight: 0.3        # é™ä½ä¿æŒæŸå¤±æƒé‡
  
  # ç»†èŠ‚ä¿æŒæŸå¤±
  edge_preservation_weight: 0.2   # é™ä½è¾¹ç¼˜ä¿æŒæŸå¤±æƒé‡
  perceptual_weight: 0.01         # ä¿®å¤ï¼šå¤§å¹…é™ä½æ„ŸçŸ¥æŸå¤±æƒé‡ï¼ˆä»0.1åˆ°0.01ï¼Œé™ä½10å€ï¼‰
  
  # æ³¨æ„åŠ›ç›‘ç£æŸå¤±ï¼ˆé˜²æ­¢æ³¨æ„åŠ›æœºåˆ¶å¤±æ•ˆï¼‰
  attention_supervision_weight: 0.1  # çº¦æŸç©ºé—´æ³¨æ„åŠ›ç¨€ç–æ€§å’Œå‡†ç¡®æ€§

# è®­ç»ƒé…ç½® - é€‚åº”æ®‹å·®å­¦ä¹ ç‰¹ç‚¹
training:
  # åŸºç¡€è®­ç»ƒå‚æ•°
  batch_size: 1                   # å…¨åˆ†è¾¨ç‡ä»éœ€batch_size=1
  num_workers: 0                  # é¿å…å¤šè¿›ç¨‹å†…å­˜å¼€é”€
  
  # å­¦ä¹ é…ç½® - é’ˆå¯¹æ®‹å·®å­¦ä¹ è°ƒæ•´å’Œè®­ç»ƒç¨³å®šæ€§
  max_epochs: 200                 # å¢åŠ epochsï¼Œæ®‹å·®å­¦ä¹ éœ€è¦æ›´å¤šè¿­ä»£
  learning_rate: 0.0002           # ğŸ”§ ä¿®å¤ï¼šå­¦ä¹ ç‡æå‡10å€è§£å†³æ”¶æ•›è¿‡æ…¢é—®é¢˜ 
  weight_decay: 0.00005           # ç¨å¾®é™ä½weight_decay
  
  # å†…å­˜ä¼˜åŒ–è®¾ç½®
  dataloader_pin_memory: false
  persistent_workers: false

# ä¼˜åŒ–å™¨é…ç½® - é’ˆå¯¹æ®‹å·®å­¦ä¹ ä¼˜åŒ–å’Œè®­ç»ƒç¨³å®šæ€§
optimizer:
  type: "adamw"
  lr: 0.0002                      # ğŸ”§ ä¿®å¤ï¼šå­¦ä¹ ç‡æå‡10å€è§£å†³æ”¶æ•›è¿‡æ…¢é—®é¢˜
  weight_decay: 0.00005           # ç¨å¾®é™ä½weight_decay
  betas: [0.9, 0.999]
  eps: 0.00000001

# è®­ç»ƒå™¨é…ç½® - æ›´ç²¾ç»†çš„æ§åˆ¶
trainer:
  # æ¢¯åº¦æ§åˆ¶ - é’ˆå¯¹è®­ç»ƒç¨³å®šæ€§ä¼˜åŒ–ï¼ˆå†…å­˜ä¼˜åŒ–ç‰ˆæœ¬ï¼‰
  accumulate_grad_batches: 12     # è¿›ä¸€æ­¥å¢åŠ ç´¯ç§¯æ‰¹æ¬¡ä»¥é™ä½å†…å­˜å³°å€¼
  precision: 32                   # ç»§ç»­ä½¿ç”¨FP32ç¡®ä¿æ®‹å·®ç²¾åº¦
  gradient_clip_val: 1.0          # æ”¾å®½æ¢¯åº¦è£å‰ªï¼Œé¿è¿‡è¿‡åº¦é™åˆ¶
  
  # æ£€æŸ¥ç‚¹è®¾ç½®
  val_check_interval: 0.2         # æ›´é¢‘ç¹éªŒè¯
  check_val_every_n_epoch: 2      # æ¯2ä¸ªepochéªŒè¯
  
  # å†…å­˜ç®¡ç†
  detect_anomaly: false
  benchmark: false
  deterministic: false

# æ—©åœé…ç½® - é€‚åº”æ®‹å·®å­¦ä¹ æ”¶æ•›ç‰¹ç‚¹
early_stopping:
  monitor: "val_loss"
  patience: 25                    # æ®‹å·®å­¦ä¹ æ”¶æ•›å¯èƒ½æ›´æ…¢
  mode: "min"
  min_delta: 0.0003              # æ›´å°çš„æ”¹å–„é˜ˆå€¼

# æ—¥å¿—é…ç½®
wandb:
  enabled: false

tensorboard:
  enabled: true
  save_dir: "./logs/residual_mv_guided"

# é«˜çº§ç›‘æ§é…ç½® - ä¸“é—¨ç›‘æ§æ®‹å·®å­¦ä¹ æ•ˆæœ
logging:
  level: "INFO"
  save_dir: "./logs/residual_mv_guided"
  
  advanced_monitoring:
    enabled: true
    
    # å›¾åƒå¯è§†åŒ– - é‡ç‚¹è§‚å¯Ÿæ®‹å·®ä¿®æ­£æ•ˆæœ
    image_visualization:
      enabled: true
      save_every_n_epochs: 2
      max_samples_per_epoch: 4
      save_format: "jpg"
      quality: 95
      
      # æ®‹å·®å­¦ä¹ ä¸“é—¨å¯è§†åŒ–
      visualize_residuals: true           # å¯è§†åŒ–æ®‹å·®ä¿®æ­£
      visualize_spatial_attention: true   # å¯è§†åŒ–ç©ºé—´æ³¨æ„åŠ›
      visualize_mv_guidance: true         # å¯è§†åŒ–MVæŒ‡å¯¼
    
    # æŸå¤±ç›‘æ§ - è¯¦ç»†è¿½è¸ªå„é¡¹æ®‹å·®æŸå¤±
    loss_monitoring:
      enabled: true
      log_frequency: 10
      track_loss_components: true         # è¿½è¸ªæŸå¤±ç»„ä»¶
    
    # æ¢¯åº¦ç›‘æ§ - æ®‹å·®å­¦ä¹ çš„æ¢¯åº¦æµåˆ†æ
    gradient_monitoring:
      enabled: true
      log_frequency: 20
      
    # æ€§èƒ½ç›‘æ§ï¼ˆç´§æ€¥å†…å­˜æ¨¡å¼ï¼‰
    performance_monitoring:
      enabled: true
      gpu_memory_threshold: 0.55    # æ›´ä¸¥æ ¼çš„å†…å­˜ç›‘æ§é˜ˆå€¼
      log_frequency: 5              # æ›´é¢‘ç¹çš„å†…å­˜ç›‘æ§

# å†…å­˜å®‰å…¨è®¾ç½® - ç´§æ€¥å†…å­˜ä¼˜åŒ–
memory_safety:
  # GPUå†…å­˜ç®¡ç†ï¼ˆç´§æ€¥æ¨¡å¼ï¼‰
  gpu_memory_fraction: 0.60       # è¿›ä¸€æ­¥é™ä½å†…å­˜ä½¿ç”¨é˜ˆå€¼
  allow_growth: true
  
  # ç³»ç»Ÿå†…å­˜ç®¡ç†
  max_system_memory_gb: 16
  
  # æ¸…ç†ç­–ç•¥ - æåº¦ç§¯æçš„å†…å­˜ç®¡ç†
  emergency_cleanup_threshold: 0.55  # æ›´æ—©è§¦å‘ç´§æ€¥æ¸…ç†
  auto_garbage_collection: true
  checkpoint_memory_cleanup: true
  validation_memory_cleanup: true
  force_cleanup_every_n_batches: 2   # æ¯2ä¸ªbatchå¼ºåˆ¶æ¸…ç†ä¸€æ¬¡

# æ®‹å·®å­¦ä¹ ç›‘æ§ - æ–°å¢ä¸“é—¨ç›‘æ§éƒ¨åˆ†
residual_learning_monitoring:
  enabled: true
  
  # æ®‹å·®è´¨é‡ç›‘æ§
  monitor_residual_quality: true
  residual_quality_metrics: ["mse", "l1", "ssim"]
  residual_log_frequency: 50
  
  # ç©ºé—´æ³¨æ„åŠ›ç›‘æ§
  monitor_spatial_attention: true
  attention_map_log_frequency: 100
  attention_statistics: true           # ç»Ÿè®¡attentionåˆ†å¸ƒ
  
  # MVæŒ‡å¯¼æ•ˆæœç›‘æ§
  monitor_mv_guidance: true
  mv_guidance_log_frequency: 75
  mv_effectiveness_metrics: true      # MVæŒ‡å¯¼æœ‰æ•ˆæ€§æŒ‡æ ‡
  
  # ä¿æŒæ€§ç›‘æ§ï¼ˆéä¿®å¤åŒºåŸŸæ˜¯å¦è¢«ä¿æŒï¼‰
  monitor_preservation_quality: true
  preservation_log_frequency: 100
  
  # é€‰æ‹©æ€§ä¿®å¤ç›‘æ§
  monitor_selective_repair: true
  repair_region_analysis: true        # ä¿®å¤åŒºåŸŸåˆ†æ
  repair_quality_metrics: true       # ä¿®å¤è´¨é‡æŒ‡æ ‡

# å®éªŒå¯¹æ¯”è®¾ç½® - ä¸å…¶ä»–æ¶æ„å¯¹æ¯”
experiment_comparison:
  enabled: true
  baseline_models: 
    - "simplified_unet"
    - "enhanced_unet"  
    - "heterogeneous_unet"
  comparison_metrics:
    - "residual_mse"
    - "spatial_weighted_loss"
    - "preservation_quality"
    - "training_stability"
    - "convergence_speed"
    - "visual_quality"
    - "parameter_efficiency"
    
# è°ƒè¯•å’Œåˆ†æé…ç½®
debugging:
  enabled: false                     # ç”Ÿäº§æ—¶å…³é—­
  save_intermediate_outputs: false   # ä¿å­˜ä¸­é—´è¾“å‡ºç”¨äºåˆ†æ
  log_tensor_shapes: false          # è®°å½•å¼ é‡å½¢çŠ¶
  profile_forward_pass: false       # å‰å‘ä¼ æ’­æ€§èƒ½åˆ†æ

# ç‰¹æ®ŠåŠŸèƒ½é…ç½®
special_features:
  # HDRå¤„ç†
  hdr_processing:
    enabled: true
    tone_mapping_method: "reinhard"   # TensorBoardå¯è§†åŒ–ç”¨
    gamma_correction: 2.2
    
  # æ•°æ®éªŒè¯
  data_validation:
    enabled: true
    check_mv_range: true             # æ£€æŸ¥MVèŒƒå›´åˆç†æ€§
    check_mask_validity: true       # æ£€æŸ¥æ©ç æœ‰æ•ˆæ€§
    log_data_statistics: true       # è®°å½•æ•°æ®ç»Ÿè®¡
    
  # æ¨¡å‹éªŒè¯
  model_validation:
    enabled: true
    check_residual_learning: true   # éªŒè¯æ®‹å·®å­¦ä¹ æ˜¯å¦æ­£å¸¸
    check_spatial_attention: true  # éªŒè¯ç©ºé—´æ³¨æ„åŠ›
    validate_preservation: true    # éªŒè¯ä¿æŒæ€§